<!-- <!DOCTYPE html5> -->
<html>
<head>
<!-- <meta charset="UTF-8"> -->
<title>Hotel Chain</title>
<link rel="stylesheet" href="login_style.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"> 
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"> 
</head>
<body>
	<div class="header">
		<div class="container">
			<button type="button" class="login-button" onclick="location.href='index.html'">Home</button>
			<button type="button" class="about-button" onclick="location.href='about_us.html'">About us</button>
		</div>
		<div class="form-box">
			<div class="button-box">
				<div id="button"></div>
				<button type="button" class="toggle_button" onclick="login()">Log In</button> 
				<button type="button" class="toggle_button" onclick="register()">Register</button> 
			</div>
			<div id="error">
				Error
			</div>
			<form id="login" class="input-group">
				<input type="text" class="input-field" placeholder="Email" required="" id="emailAuth">
				<input type="password" class="input-field" placeholder="Password" required="" id="passAuth">
				<!-- <input type="checkbox" class="check-box"><span>Remeber Password</span> -->
				<button type="submit" class="submit-button">Log In</button>
			</form>
			<form id="register" class="input-group">
				<input type="text" class="input-field" placeholder="First name" required="" id="firstNameReg">
				<input type="text" class="input-field" placeholder="Last name" required="" id="lastNameReg">
				<input type="text" class="input-field" placeholder="Email" required="" id="emailReg">
				<input type="password" class="input-field" placeholder="Password" required="" id="passReg">
				<input type="text" class="input-field-date" placeholder="Date Of Birth" required="" onfocus="(this.type='date')" onblur="(this.type='text')" id="dobReg">
				<input type="radio" class="check-box" value="Male" name="gender" required="" id="maleReg"><span>Male</span><input type="radio" class="check-box" value="Female" name="gender"required="" id="femaleReg"><span>Female</span>
				<button type="submit" class="submit-button">Register</button>
			</form>
		</div>
	</div>

	<script type="text/javascript">
		var loginvar = document.getElementById("login");
		var registervar = document.getElementById("register");
		var buttonvar = document.getElementById("button");

		function register(){
			loginvar.style.display = 'none';
			loginvar.style.left = "-400px";
			registervar.style.left = "0";
			registervar.style.display = "block";
			buttonvar.style.left = "115px";
		}

		function login(){
			loginvar.style.display = 'block';
			loginvar.style.left = "0";
			registervar.style.left = "400px";
			registervar.style.display = 'none';
			buttonvar.style.left = "0";
		}
		if(loginvar.addEventListener("submit", (e) => {
			let email = document.getElementById('emailAuth').value;
			let password = document.getElementById('passAuth').value;
			e.preventDefault();
			fetch('http://localhost:8080/api/users/login', {
				headers: {
					'Accept': 'application/json, text/plain',
					'Content-Type': 'application/json;charset=UTF-8'
				},
				body: JSON.stringify({
					email: email,
					password: password
				}),
				method: "POST"
			}).then((res) => {
				if(!res.ok) {
					let error = document.getElementById('error');
					error.style.opacity = '100%';
					return res.json().then((body) => {
						error.innerText = body[0].message;
					})
				} else {
					localStorage.setItem("loggedIn", "token");
					const urlSplitted = window.location.href.split("/");
					urlSplitted[urlSplitted.length - 1] = 'index.html';
					window.location.href = urlSplitted.join("/");
					return res.json();
				}
			})
			// alert('submitted');
		}));

		if(registervar.addEventListener("submit", (e) => {
			let firstName = document.getElementById('firstNameReg').value;
			let lastName = document.getElementById('lastNameReg').value;
			let email = document.getElementById('emailReg').value;
			let password = document.getElementById('passReg').value;
			let dateOfBirth = document.getElementById('dobReg').value;
			let gender;
			if (document.getElementById('maleReg').checked)
				gender = 'male';
			else if (document.getElementById('femaleReg').checked)
				gender = 'female';
			e.preventDefault();
			fetch('http://localhost:8080/api/users/', {
				headers: {
					'Accept': 'application/json, text/plain',
					'Content-Type': 'application/json;charset=UTF-8'
				},
				body: JSON.stringify({
					firstName: firstName,
					lastName: lastName,
					email: email,
					password: password,
					dateOfBirth: dateOfBirth,
					gender: gender
				}),
				method: "POST"
			}).then((res) => {
				if(!res.ok) {
					let error = document.getElementById('error');
					error.style.opacity = '100%';
					return res.json().then((body) => {
						error.innerText = body[0].message;
					})
				} else {
					const urlSplitted = window.location.href.split("/");
					urlSplitted[urlSplitted.length - 1] = 'login.html';
					window.location.href = urlSplitted.join("/");
					return res.json();
				}
			})
			// alert('submitted');
		}));

		if(localStorage.getItem("loggedIn")) {
			const urlSplitted = window.location.href.split("/");
			urlSplitted[urlSplitted.length - 1] = 'index.html';
			window.location.href = urlSplitted.join("/");
		}

	</script>

</body>
</html>